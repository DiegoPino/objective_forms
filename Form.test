<?php

// $Id$

/**
 * @file
 *
 */
class ObjectiveForms_Form_TestCase extends DrupalUnitTestCase {

  /**
   * Get Test info.
   * 
   * @return array
   *   Properties that are displayed in the test selection form.
   */
  public static function getInfo() {
    return array(
      'name' => 'Form Unit Tests.',
      'description' => 'Unit tests for Form.inc.',
      'group' => 'Objective Forms',
    );
  }

  /**
   * setUp() performs any pre-requisite tasks that need to happen. 
   */
  public function setUp() {
    // Enable any modules required for the test.
    parent::setUp('objective_forms');
    module_load_include('inc', 'objective_forms', 'Form');
  }

  /**
   * Test constructing the Form definition.
   */
  public function testCreate() {
    /* Basic single form element */
    $form_state = array();
    $form = new Form($form_state);
    $this->assertNotNull($form->storage, 'FormStorage was created.');
    $this->assertNotNull($form->registry, 'FormElementRegistry was created.');
    $this->assertNotNull($form->root, 'The root element was created.');
    /* Basic Adding properties - Array Access */
    $form['#attributes'] = array('enctype' => 'multipart/form-data');
    $this->assertEqual($form['#attributes']['enctype'], 'multipart/form-data', 'Correctly set form property via array access.');
    /* Basic Adding properties - Get/Set */
    $form->attributes = array('enctype' => 'overwrote previous value');
    $this->assertEqual($form->attributes['enctype'], 'overwrote previous value', 'Correctly set form property via get/set.');
    /* Basic Add Form Element - Array Access */
    $form_element = new FormElement(array('#title' => 'first'));
    $form['first'] = $form_element;
    $this->assertIdentical($form['first'], $form_element, 'Correctly set form element via array access.');
    $form_element = new FormElement(array('#title' => 'second'));
    $form->first = $form_element;
    $this->assertIdentical($form->first, $form_element, 'Correctly set form element via get/set.');
  }

  /**
   * 
   */
  public function testToArray() {
    $form_state = array();
    $form = new Form($form_state);
    $form['#attributes'] = array('enctype' => 'multipart/form-data');
    $form->first = new FormElement(array('#title' => 'first'));
    $form->first->second = new FormElement(array('#title' => 'second'));
    $form->third = new FormElement(array('#title' => 'third'));
    $this->pass('Before to array');
    $output = $form->toArray();
    $expected_output = array(
      '#attributes' => array(
        'enctype' => 'multipart/form-data',
      ),
      'first' => array(
        '#title' => 'first',
        'second' => array(
          '#title' => 'second'
        )
      ),
      'third' => array(
        '#title' => 'third',
      )
    );
    $this->assertEqual($output, $expected_output, 'Form::toArray()\'s output matched its expected value.');
  }

}